<?
function getTitle() {
    return 'Shopling API Manual';
}

function menuAttrString($data) {
    $attr = array();
    foreach ($data as $k => $v) { $attr[] = "data-$k=\"$v\""; }
    return implode(' ', $attr);
}

function pageLastUpdateDate() {
    return '마지막 수정일시: ' . date('Y-m-d H:i:s', filemtime($_SERVER['SCRIPT_FILENAME']));
}

function apiStringToArray($string) {
    $rows = explode("\n", $string);

    $result = array();

    foreach ($rows as $row) {
        $col = explode("\t", $row);

        $result[] = array(
            'xml_node'      => $col[0],
            'repeat'        => trim($col[1]),
            'field'         => trim($col[2]),
            'field_desc'    => trim($col[3]),
            'data_type'     => trim($col[4]),
            'format'        => trim($col[5]),
            'max'           => trim($col[6]),
            'mandatory'     => trim($col[7]),
            'note'          => str_replace(' ', '&nbsp;', trim($col[8])),
        );
    }

    return $result;
}

function apiTableHeadHTML($title) {
    return "
    <tr>
        <th style='width:50px;'  >{$title}   </th>
        <th style='width:150px;' >XML node   </th>
        <th style='width:30px;'  >반복       </th>
        <th style='width:100px;' >field      </th>
        <th style='width:300px;' >field 설명 </th>
        <th style='width:80px;'  >Data type  </th>
        <th style='width:50px;'  >format     </th>
        <th style='width:20px;'  >max        </th>
        <th style='width:30px;'  >필수       </th>
        <th style='width:500px;' >비고       </th>
    </tr>";
}

function apiTableBodyHTML($div, $row) {
    echo "
    <tr>
        <td class='center'><xmp>{$div}</xmp></td>
        <td><xmp>".$row['xml_node']."</xmp></td>
        <td><xmp>".$row['repeat']."</xmp></td>
        <td><xmp>".$row['field']."</xmp></td>
        <td>".$row['field_desc']."</td>
        <td class='center'><xmp>".$row['data_type']."</xmp></td>
        <td><xmp>".$row['format']."</xmp></td>
        <td><xmp>".$row['max']."</xmp></td>
        <td class='center'><xmp>".$row['mandatory']."</xmp></td>
        <td>".$row['note']."</td>
    </tr>";
}

function apiURL($path) {
    $domain = 'https://api.shopling.co.kr';

    return "{$domain}/{$path}?mode=1&xml_src_url=(아래 xml 데이타가 있는 url 기술)
{$domain}/{$path}?mode=2     -> 소켓통신으로 바로 xml로 밀어넣을시";
}

function fieldStringToArray($string) {
    $rows = explode("\n", $string);

    $result = array();

    foreach ($rows as $row) {
        $col = array_map('trim', explode("\t", $row));

        $result[] = $col;
    }

    return $result;
}

function checkCmpyId($cmpy_id = null) {
    if ($cmpy_id !== false && $_SERVER['HTTP_REFERER'] !== 'https://a.shopling.co.kr/z_test/api/manual/') {
        return false;
    }

    if (!function_exists('a_fnc_login_check')) {
        require_once($_SERVER['DOCUMENT_ROOT'].'/../lib/a_fnc.lib');
    }

    //a_fnc_login_check();

    $pagename = basename($_SERVER['PHP_SELF'], '.phtml');

    if (in_array($pagename, array('1','2','3','4','5','6'))) {
        return prdCmpyId($cmpy_id);
    }

    if (in_array($pagename, array('18','19','20'))) {
        return prdGetCmpyId($cmpy_id);
    }

    if (in_array($pagename, array('7','8','9','10','11','12','13','14','15','16','17'))) {
        return ordCmpyId($cmpy_id);
    }

    if (in_array($pagename, array('21','index','menu'))) {
        return allCmpyId($cmpy_id);
    }
}

function allCmpyId($cmpy_id = null) {
    return prdCmpyId($cmpy_id) || prdGetCmpyId($cmpy_id) || ordCmpyId($cmpy_id);
}

function prdCmpyId($cmpy_id = null) {
    return true;

    if (is_null($cmpy_id)) {
        $cmpy_id = $_COOKIE['CASS_cmpy_id'] ? $_COOKIE['CASS_cmpy_id'] : $_SESSION['CMPY_ID'];
    }

    $rst = in_array($cmpy_id, array(
        'S0000001','S0007435','S0001677',           'S0008075','S0000720','S0000225','S0002527','S0000169'
    ));

    return $rst;
}

function prdGetCmpyId($cmpy_id = null) {
    return true;

    if (is_null($cmpy_id)) {
        $cmpy_id = $_COOKIE['CASS_cmpy_id'] ? $_COOKIE['CASS_cmpy_id'] : $_SESSION['CMPY_ID'];
    }

    return prdCmpyId($cmpy_id);

    $rst = in_array($cmpy_id, array(
        'S0000001','S0007435','S0001677',           'S0008075','S0000720','S0000225','S0002527','S0000169'
    ));

    return $rst;
}

function ordCmpyId($cmpy_id = null) {
    return true;

    if (is_null($cmpy_id)) {
        $cmpy_id = $_COOKIE['CASS_cmpy_id'] ? $_COOKIE['CASS_cmpy_id'] : $_SESSION['CMPY_ID'];
    }

    $rst = in_array($cmpy_id, array(
        'S0000001','S0007435','S0001677','S0000699','S0008075','S0000720','S0000225','S0002527','S0000169'
    ));

    return $rst;
}